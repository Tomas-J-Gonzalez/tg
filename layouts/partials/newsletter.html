<section class="region flow" id="signup" aria-labelledby="newsletter-heading">
  <h2 id="newsletter-heading">
    {{ with .Params.signup_title }}
      {{ . }}
    {{ else }}
      {{ .Site.Data.settings.signup.title | markdownify }}
    {{ end }}
  </h2>
  <p>
    {{ with .Params.signup_desc }}
      {{ . | markdownify }}
    {{ else }} 
      {{ .Site.Data.settings.signup.desc | markdownify }}
    {{ end }}
  </p>

  <form class="Subscribe switcher validate" data-layout="33x3" id="custom-newsletter-form" action="https://eomail5.com/form/54470b64-ac74-11f0-83c2-85c01e4c72d7" method="post" target="emailoctopus-iframe" novalidate aria-labelledby="newsletter-heading">
    <div>
      <label for="name">First Name <span aria-label="required" class="sr-only">(required)</span></label>
      <input id="name" name="field_0" placeholder="e.g. TomÃ¡s" type="text" aria-required="true" autocomplete="off" spellcheck="false" data-form-type="other" required>
    </div>

    <div>
      <label for="email">Email Address <span aria-label="required" class="sr-only">(required)</span></label>
      <input id="email" name="field_1" placeholder="e.g. your.email@example.com" type="email" aria-required="true" autocomplete="off" spellcheck="false" data-form-type="other" required>
    </div>
    
    <div>
      <!-- Add merge tag to show what page folks sign up on -->
      <input class="visually-hidden" name="field_2" value="{{ .Title }}" type="hidden" id="location">
      
      <div id="form-messages">
        <div id="success-message" style="display:none; color: green; margin-top: 1rem;">
          Thanks for subscribing! Check your email to confirm.
        </div>
        <div id="error-message" style="display:none; color: red; margin-top: 1rem;">
          Something went wrong. Please try again.
        </div>
      </div>

      <button class="w-full" id="subscribe" name="subscribe" type="submit">Subscribe</button>
    </div>
  </form>

  <!-- Hidden iframe to handle form submission -->
  <iframe id="emailoctopus-iframe" name="emailoctopus-iframe" style="display: none;" onload="handleFormResponse()"></iframe>

  <script>
    function handleFormResponse() {
      // This function runs when the iframe loads (form submission complete)
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      const submitButton = document.getElementById('subscribe');
      
      // Since we can't read iframe content due to cross-origin restrictions,
      // we'll assume success after a short delay
      setTimeout(() => {
        successMessage.style.display = 'block';
        document.getElementById('custom-newsletter-form').reset();
        submitButton.disabled = false;
        submitButton.textContent = 'Subscribe';
      }, 2000);
    }

    document.getElementById('custom-newsletter-form').addEventListener('submit', function(e) {
      const submitButton = document.getElementById('subscribe');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      
      // Hide previous messages
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      
      // Disable submit button
      submitButton.disabled = true;
      submitButton.textContent = 'Subscribing...';
      
      // The form will submit to the iframe, and handleFormResponse() will be called
    });
  </script>
</section>